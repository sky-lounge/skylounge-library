---
uri: sky-lounge/skylounge-library/blueprints/app/web/blueprint.yml
params:
  registry_url: us-central1-docker.pkg.dev/skylounge-common/skylounge-registry
workflows:
  development:
    jobs:
      unit-test:
        - steps:
            unit-test:
              - label: gradlew
                uri: sky-lounge/skylounge-library/steps/unit-test/gradlew/unit-test.yml
                params:
                  jvm_version: 17
              - label: nginx
                uri: sky-lounge/skylounge-library/steps/unit-test/nginx/unit-test.yml
      build:
        - steps:
            cloud-auth:
              - label: gcp
                uri: sky-lounge/skylounge-library/steps/gcp/cloud-auth/auth.yml
                params:
                  credentials_json_secret_string: "${{ secrets.GOOGLE_CREDENTIALS_DEV }}"
            build-container-image:
              - label: gradlew
                uri: sky-lounge/skylounge-library/steps/pack/gradlew/build.yml
                params:
                  jvm_version: 17
              - label: nginx
                uri: sky-lounge/skylounge-library/steps/pack/nginx/build.yml
            push-container-image:
              - label: gcp
                uri: sky-lounge/skylounge-library/steps/gcp/artifact-registry/push/push.yml
            upload-sboms:
              - label: gcp
                uri: sky-lounge/skylounge-library/steps/gcp/cloud-storage/sbom/push/push.yml
                params:
                  sbom_bucket: sboms.skylounge.io
      deploy:
        - label: cloud-run
          uri: sky-lounge/skylounge-library/jobs/gcp/cloud-run/deploy/deploy.yml
          params:
            cloud_run_location: us-central1
            credentials_json_secret_string: "${{ secrets.GOOGLE_CREDENTIALS_DEV }}"
            dns_zone_name: skyloungedev
            gcp_project: skylounge-dev
            tf_state_bucket: tfstate.skylounge.dev
