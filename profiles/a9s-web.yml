---
uri: sky-lounge/skylounge-library/blueprints/cloudfoundry/cloud-gov/blueprint.yml
params:
  main_branch: main
workflows:
  pull-request:
    jobs:
      unit-test:
        - steps:
            unit-test:
              - label: go
                uri: sky-lounge/skylounge-library/steps/unit-test/go/unit-test.yml
                params:
                  go-version: stable
                  check-latest: true
              - label: gradlew
                uri: sky-lounge/skylounge-library/steps/unit-test/gradlew/unit-test.yml
                params:
                  jvm_version: 17
              - label: nginx
                uri: sky-lounge/skylounge-library/steps/unit-test/nginx/unit-test.yml
      dependency-review:
        - params:
            config_file: "sky-lounge/skylounge-library/jobs/github/security/dependency-review/config/cloud-gov.yml@main"
      codeql:
        - label: java
          params:
            language_array: ["Java"]
          steps:
            build:
              - uri: sky-lounge/skylounge-library/steps/github/security/codeql/auto-build/step.yml
        - label: nginx
          params:
            language_array: ["JavaScript"]
          steps:
            build:
              - uri: sky-lounge/skylounge-library/steps/github/security/codeql/manual-build/step.yml
  development:
    jobs:
      deploy:
        - steps:
            deploy:
              - uri: sky-lounge/skylounge-library/steps/cloudfoundry/deploy/deploy.yml
                params:
                  cf_api: "https://api.de.a9s.eu"
                  cf_username: "${{ secrets.CF_DEV_USERNAME }}"
                  cf_password: "${{ secrets.CF_DEV_PASSWORD }}"
                  cf_manifest: "cf/dev-manifest.yml"
  production:
    jobs:
      deploy:
        - steps:
            deploy:
              - uri: sky-lounge/skylounge-library/steps/cloudfoundry/deploy/deploy.yml
                params:
                  cf_api: "https://api.de.a9s.eu"
                  cf_username: "${{ secrets.CF_PROD_USERNAME }}"
                  cf_password: "${{ secrets.CF_PROD_PASSWORD }}"
                  cf_manifest: "cf/prod-manifest.yml"
  scans:
    jobs:
      dependency-review:
        - params:
            config_file: "sky-lounge/skylounge-library/jobs/github/security/dependency-review/config/cloud-gov.yml@main"
      codeql:
        - label: java
          uri: sky-lounge/skylounge-library/jobs/codeql/auto-build/job.yml
          params:
            language_array: ["Java"]
        - label: nginx
          uri: sky-lounge/skylounge-library/jobs/codeql/manual-build/job.yml
          params:
            language_array: ["JavaScript"]
