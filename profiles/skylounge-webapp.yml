---
uri: sky-lounge/skylounge-library/blueprints/gcp/cloud-run/blueprint.yml
params:
  registry_url: us-central1-docker.pkg.dev/skylounge-common/skylounge-registry
workflows:
  development:
    jobs:
      unit-test:
        - steps:
            unit-test:
              - label: go
                uri: sky-lounge/skylounge-library/steps/unit-test/go/step.yml
                params:
                  go_version: stable
                  check_latest: true
              - label: gradlew
                uri: sky-lounge/skylounge-library/steps/unit-test/gradlew/step.yml
                params:
                  distribution: liberica
                  jvm_version: "17"
              - label: maven
                uri: sky-lounge/skylounge-library/steps/unit-test/maven/step.yml
                params:
                  distribution: liberica
                  jvm_version: "17"
              - label: nginx
                uri: sky-lounge/skylounge-library/steps/unit-test/nginx/step.yml
              - label: python
                uri: sky-lounge/skylounge-library/steps/unit-test/python/step.yml
                params:
                  package_manager: pip
                  python_version: "3.11"
              - label: ruby
                uri: sky-lounge/skylounge-library/steps/unit-test/ruby/step.yml
                params:
                  ruby_version: "3.2.2"
      dependency-review:
        - params:
            config_file: "sky-lounge/skylounge-library/jobs/github/security/dependency-review/config/skylounge.yml@main"
      codeql:
        - label: go
          params:
            language_array: ["Go"]
          steps:
            build:
              - uri: sky-lounge/skylounge-library/steps/github/security/codeql/auto-build/step.yml
        - label: java
          params:
            language_array: ["Java"]
          steps:
            build:
              - uri: sky-lounge/skylounge-library/steps/github/security/codeql/auto-build/step.yml
        - label: nginx
          params:
            language_array: ["JavaScript"]
          steps:
            build:
              - uri: sky-lounge/skylounge-library/steps/github/security/codeql/script-build/step.yml
        - label: python
          params:
            language_array: ["Python"]
          steps:
            build:
              - uri: sky-lounge/skylounge-library/steps/github/security/codeql/script-build/step.yml
        - label: ruby
          params:
            language_array: ["Ruby"]
          steps:
            build:
              - uri: sky-lounge/skylounge-library/steps/github/security/codeql/script-build/step.yml
      build:
        - steps:
            build-container-image:
              - label: gradlew
                uri: sky-lounge/skylounge-library/steps/pack/gradlew/build.yml
                params:
                  jvm_version: 17
                  distribution: liberica
              - label: nginx
                uri: sky-lounge/skylounge-library/steps/pack/nginx/build.yml
      configure-access:
        - params:
            cloud_run_location: us-central1
            dns_zone_name: skyloungedev
            tf_state_bucket: tfstate.skylounge.dev
    params:
      gcp_project: skylounge-dev
  production:
    params:
      gcp_project: skylounge-io
    jobs:
      configure-access:
        - params:
            cloud_run_location: us-central1
            dns_zone_name: skyloungeprod
            tf_state_bucket: tfstate.skylounge.io
