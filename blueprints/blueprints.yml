---
blueprints:
  - label: webapp
    uri: sky-lounge/skylounge-library/blueprints/app/web/blueprint.yml
    params:
      registry_url: us-central1-docker.pkg.dev/skylounge-common/skylounge-registry
    workflows:
      development:
        jobs:
          build:
            - steps:
                unit-test:
                  - label: gradlew
                    uri: sky-lounge/skylounge-library/steps/unit-test/gradlew/build.yml
                    params:
                      jvm_version: 17
                build-container-image:
                  - label: gradlew
                    uri: sky-lounge/skylounge-library/steps/build/pack/gradlew/build.yml
                    params:
                      jvm_version: 17
                  - label: nginx
                    uri: sky-lounge/skylounge-library/steps/build/pack/nginx/build.yml
          deploy:
            - label: cloud-run
              uri: sky-lounge/skylounge-library/jobs/gcp/cloud-run/deploy.yml
              params:
                tf_state_bucket: tfstate.skylounge.dev
                dns_zone_name: skyloungedev
                cloud_run_location: us-central1
            - label: cloud-gov
              uri: sky-lounge/skylounge-library/jobs/cloudfoundry/cloudgov/deploy.yml
        params:
          gcp_project_id: skyloungedev
      production:
        jobs:
          deploy:
            - label: cloud-run
              uri: sky-lounge/skylounge-library/jobs/gcp/cloud-run/deploy.yml
              params:
                tf_state_bucket: tfstate.skylounge.io
                dns_zone_name: skyloungeio
                cloud_run_location: us-central1
        params:
          gcp_project_id: skyloungeio
